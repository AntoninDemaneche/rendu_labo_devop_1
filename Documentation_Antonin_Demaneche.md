# TP 3 - Ansible - AntoninDemaneche

## 1 - La configuration des nodes 

Dans un premiére temps nous allons instaler les trois vms avec les hardwares correspondant.

Il ne faut pas oublier de modifier les ips de chaque node : 

node master :  10.0.0.2
node worker 1 : 10.0.0.3
node worker 2 : 10.0.0.4

Une fois les machines correctement lancé, il faudras installer python et openssh.

dminnis@adminnis-virtual-machine:~$ sudo apt update
[sudo] password for adminnis: 
Get:1 http://security.ubuntu.com/ubuntu focal-security InRelease [109 kB]
Hit:2 http://us.archive.ubuntu.com/ubuntu focal InRelease
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease [101 kB]
Fetched 324 kB in 1s (331 kB/s)   
Reading package lists... Done
Building dependency tree       
Reading state information... Done
275 packages can be upgraded. Run 'apt list --upgradable' to see them.
adminnis@adminnis-virtual-machine:~$ sudo apt install python3.8
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  libpython3.8 libpython3.8-minimal libpython3.8-stdlib python3.8-minimal
Suggested packages:
  python3.8-venv python3.8-doc binutils binfmt-support
The following packages will be upgraded:
  libpython3.8 libpython3.8-minimal libpython3.8-stdlib python3.8 python3.8-minimal
5 upgraded, 0 newly installed, 0 to remove and 270 not upgraded.
Need to get 0 B/6,282 kB of archives.
After this operation, 203 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
(Reading database ... 179799 files and directories currently installed.)
Preparing to unpack .../libpython3.8_3.8.5-1~20.04_amd64.deb ...
Unpacking libpython3.8:amd64 (3.8.5-1~20.04) over (3.8.2-1ubuntu1.2) ...
Preparing to unpack .../python3.8_3.8.5-1~20.04_amd64.deb ...
Unpacking python3.8 (3.8.5-1~20.04) over (3.8.2-1ubuntu1.2) ...
Preparing to unpack .../libpython3.8-stdlib_3.8.5-1~20.04_amd64.deb ...
Unpacking libpython3.8-stdlib:amd64 (3.8.5-1~20.04) over (3.8.2-1ubuntu1.2) ...
Preparing to unpack .../python3.8-minimal_3.8.5-1~20.04_amd64.deb ...
Unpacking python3.8-minimal (3.8.5-1~20.04) over (3.8.2-1ubuntu1.2) ...
Preparing to unpack .../libpython3.8-minimal_3.8.5-1~20.04_amd64.deb ...
Unpacking libpython3.8-minimal:amd64 (3.8.5-1~20.04) over (3.8.2-1ubuntu1.2) ...
Setting up libpython3.8-minimal:amd64 (3.8.5-1~20.04) ...
Setting up python3.8-minimal (3.8.5-1~20.04) ...
Setting up libpython3.8-stdlib:amd64 (3.8.5-1~20.04) ...
Setting up python3.8 (3.8.5-1~20.04) ...
Setting up libpython3.8:amd64 (3.8.5-1~20.04) ...
Processing triggers for mime-support (3.64ubuntu1) ...
Processing triggers for gnome-menus (3.36.0-1ubuntu1) ...
Processing triggers for libc-bin (2.31-0ubuntu9) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for desktop-file-utils (0.24-1ubuntu3) ...


adminnis@adminnis-virtual-machine:~$ sudo apt install openssh-server
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  ncurses-term openssh-sftp-server ssh-import-id
Suggested packages:
  molly-guard monkeysphere ssh-askpass
The following NEW packages will be installed:
  ncurses-term openssh-server openssh-sftp-server ssh-import-id
0 upgraded, 4 newly installed, 0 to remove and 270 not upgraded.
Need to get 688 kB of archives.
After this operation, 6,010 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://us.archive.ubuntu.com/ubuntu focal/main amd64 ncurses-term all 6.2-0ubuntu2 [249 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-sftp-server amd64 1:8.2p1-4ubuntu0.1 [51.5 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-server amd64 1:8.2p1-4ubuntu0.1 [377 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu focal/main amd64 ssh-import-id all 5.10-0ubuntu1 [10.0 kB]
Fetched 688 kB in 2s (446 kB/s)     
Preconfiguring packages ...
Selecting previously unselected package ncurses-term.
(Reading database ... 179799 files and directories currently installed.)
Preparing to unpack .../ncurses-term_6.2-0ubuntu2_all.deb ...
Unpacking ncurses-term (6.2-0ubuntu2) ...
Selecting previously unselected package openssh-sftp-server.
Preparing to unpack .../openssh-sftp-server_1%3a8.2p1-4ubuntu0.1_amd64.deb ...
Unpacking openssh-sftp-server (1:8.2p1-4ubuntu0.1) ...
Selecting previously unselected package openssh-server.
Preparing to unpack .../openssh-server_1%3a8.2p1-4ubuntu0.1_amd64.deb ...
Unpacking openssh-server (1:8.2p1-4ubuntu0.1) ...
Selecting previously unselected package ssh-import-id.
Preparing to unpack .../ssh-import-id_5.10-0ubuntu1_all.deb ...
Unpacking ssh-import-id (5.10-0ubuntu1) ...
Setting up openssh-sftp-server (1:8.2p1-4ubuntu0.1) ...
Setting up openssh-server (1:8.2p1-4ubuntu0.1) ...

Creating config file /etc/ssh/sshd_config with new version
Creating SSH2 RSA key; this may take some time ...
3072 SHA256:pAukXD9wnIGDrXCK4CZMzsUhlU0hr8b6xUVMo7YK1Pk root@adminnis-virtual-machine (RSA)
Creating SSH2 ECDSA key; this may take some time ...
256 SHA256:Bw8YZTGVuPJMrb94fkRvMbCTo+TTg5ihr3m+G+6ChYE root@adminnis-virtual-machine (ECDSA)
Creating SSH2 ED25519 key; this may take some time ...
256 SHA256:QKpw5iF4OFAojJwKJadYzkwWDuyhiKfbvliOyeMB6b8 root@adminnis-virtual-machine (ED25519)
Created symlink /etc/systemd/system/sshd.service → /lib/systemd/system/ssh.service.
Created symlink /etc/systemd/system/multi-user.target.wants/ssh.service → /lib/systemd/system/ssh.service.
rescue-ssh.target is a disabled or a static unit, not starting it.
Setting up ssh-import-id (5.10-0ubuntu1) ...
Attempting to convert /etc/ssh/ssh_import_id
Setting up ncurses-term (6.2-0ubuntu2) ...
Processing triggers for systemd (245.4-4ubuntu3.2) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for ufw (0.36-6) ...
adminnis@adminnis-virtual-machine:~$ 

# 2 - Les inventory :

Config de l'inventory ini : 

```
# inventory.yaml
---
all:
  hosts:
    # Using Hostname
    admin.node:  
    # Using IP and Hostname
    master.node : 10.0.0.2
    worker1.node : 10.0.0.3
    worker2.node : 10.0.0.4
```

On install ensuite les paquets nécésaire au role common : 

# 3 - Les paquets important 

```
sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common

```
```
Reading package lists... Done
Building dependency tree       
Reading state information... Done
ca-certificates is already the newest version (20201027ubuntu0.20.04.1).
apt-transport-https is already the newest version (2.0.2ubuntu0.1).
The following additional packages will be installed:
  libcurl4 python3-software-properties software-properties-gtk
The following NEW packages will be installed:
  curl gnupg-agent
The following packages will be upgraded:
  libcurl4 python3-software-properties software-properties-common software-properties-gtk
4 upgraded, 2 newly installed, 0 to remove and 265 not upgraded.
Need to get 167 kB/500 kB of archives.
After this operation, 457 kB of additional disk space will be used.
Do you want to continue? [Y/n] Y
Get:1 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 curl amd64 7.68.0-1ubuntu2.2 [161 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 gnupg-agent all 2.2.19-3ubuntu2 [5,236 B]
Fetched 167 kB in 1s (228 kB/s)   
(Reading database ... 182661 files and directories currently installed.)
Preparing to unpack .../0-libcurl4_7.68.0-1ubuntu2.2_amd64.deb ...
Unpacking libcurl4:amd64 (7.68.0-1ubuntu2.2) over (7.68.0-1ubuntu2.1) ...
Selecting previously unselected package curl.
Preparing to unpack .../1-curl_7.68.0-1ubuntu2.2_amd64.deb ...
Unpacking curl (7.68.0-1ubuntu2.2) ...
Selecting previously unselected package gnupg-agent.
Preparing to unpack .../2-gnupg-agent_2.2.19-3ubuntu2_all.deb ...
Unpacking gnupg-agent (2.2.19-3ubuntu2) ...
Preparing to unpack .../3-software-properties-common_0.98.9.3_all.deb ...
Unpacking software-properties-common (0.98.9.3) over (0.98.9.1) ...
Preparing to unpack .../4-software-properties-gtk_0.98.9.3_all.deb ...
Unpacking software-properties-gtk (0.98.9.3) over (0.98.9.1) ...
Preparing to unpack .../5-python3-software-properties_0.98.9.3_all.deb ...
Unpacking python3-software-properties (0.98.9.3) over (0.98.9.1) ...
Setting up python3-software-properties (0.98.9.3) ...
Setting up gnupg-agent (2.2.19-3ubuntu2) ...
Setting up libcurl4:amd64 (7.68.0-1ubuntu2.2) ...
Setting up curl (7.68.0-1ubuntu2.2) ...
Setting up software-properties-common (0.98.9.3) ...
Setting up software-properties-gtk (0.98.9.3) ...
Processing triggers for dbus (1.12.16-2ubuntu2.1) ...
Processing triggers for shared-mime-info (1.15-1) ...
Processing triggers for desktop-file-utils (0.24-1ubuntu3) ...
Processing triggers for mime-support (3.64ubuntu1) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1ubuntu1) ...
Processing triggers for libglib2.0-0:amd64 (2.64.3-1~ubuntu20.04.1) ...
Processing triggers for libc-bin (2.31-0ubuntu9) ...
Processing triggers for man-db (2.9.1-1) ...

```

# 4 - Docker 

Il faut ensuite installer docker et ses dependance sur les trois machine : 
```
sudo apt-get install docker-ce docker-ce-cli containerd.io
```
# 5 - Kubernetes 

Désactivons maintenant le swap : 

```
sudo swapoff -a
```
